import{N as e,z as t,U as a,a1 as s,aO as r,aP as o,aQ as l,aR as i,T as n,q as d,aS as c,aT as h,aU as u,aV as x,I as g,P as p,aW as m,aX as b,a3 as f,aY as w,aZ as v,a0 as y,a_ as j,a2 as N,aM as k,aN as C,a$ as S}from"./vendor-react-CWmbX_Im.js";import{P as F,S as R,r as D}from"./vendor-pdf-Chr6DQ98.js";import"./vendor-CIxjMMAQ.js";const T=[{label:"Sans Serif (Helvetica)",value:"Helvetica"},{label:"Serif (Times)",value:"Times-Roman"},{label:"Monospace (Courier)",value:"Courier"}],M=({isOpen:a,onClose:s,onSave:r})=>{const o=e.useRef(null),[l,i]=e.useState(!1);e.useEffect(()=>{if(a&&o.current){const e=o.current,t=e.getContext("2d");t&&(t.clearRect(0,0,e.width,e.height),t.lineWidth=2,t.strokeStyle="#000000",t.lineCap="round")}},[a]);const n=e=>{i(!0);const t=o.current;if(!t)return;const a=t.getContext("2d");if(!a)return;const s=t.getBoundingClientRect(),r="touches"in e?e.touches[0].clientX:e.clientX,l="touches"in e?e.touches[0].clientY:e.clientY;a.beginPath(),a.moveTo(r-s.left,l-s.top)},d=e=>{if(!l)return;const t=o.current;if(!t)return;const a=t.getContext("2d");if(!a)return;const s=t.getBoundingClientRect(),r="touches"in e?e.touches[0].clientX:e.clientX,i="touches"in e?e.touches[0].clientY:e.clientY;a.lineTo(r-s.left,i-s.top),a.stroke()},c=()=>i(!1);return a?t.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:t.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-md border border-slate-200 dark:border-slate-800",children:[t.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center",children:[t.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Sign Document"}),t.jsx("button",{onClick:s,children:t.jsx(S,{className:"w-5 h-5 text-slate-500"})})]}),t.jsx("div",{className:"p-4 bg-slate-100 dark:bg-slate-950 flex justify-center",children:t.jsx("canvas",{ref:o,width:350,height:200,className:"bg-white rounded-xl border border-slate-300 shadow-sm touch-none cursor-crosshair",onMouseDown:n,onMouseMove:d,onMouseUp:c,onMouseLeave:c,onTouchStart:n,onTouchMove:d,onTouchEnd:c})}),t.jsxs("div",{className:"p-4 flex gap-3 justify-end border-t border-slate-200 dark:border-slate-800",children:[t.jsx("button",{onClick:()=>{const e=o.current,t=null==e?void 0:e.getContext("2d");null==t||t.clearRect(0,0,e.width,e.height)},className:"px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white",children:"Clear"}),t.jsx("button",{onClick:()=>{o.current&&(r(o.current.toDataURL()),s())},className:"px-6 py-2 bg-primary-600 text-white rounded-lg font-bold hover:bg-primary-700",children:"Use Signature"})]})]})}):null},z=()=>{var z,P;const[I,B]=e.useState(null),[E,L]=e.useState([]),[U,W]=e.useState({}),[H,$]=e.useState(null),[O,X]=e.useState(1),[Y,A]=e.useState(!0),[q,V]=e.useState([]),[_,J]=e.useState("select"),[Q,Z]=e.useState("#000000"),[G,K]=e.useState("transparent"),[ee,te]=e.useState(16),[ae,se]=e.useState("Helvetica"),[re,oe]=e.useState(!1),[le,ie]=e.useState(!1),[ne,de]=e.useState(null),[ce,he]=e.useState(!1),[ue,xe]=e.useState(!1),[ge,pe]=e.useState(!1),[me,be]=e.useState(!1),[fe,we]=e.useState(null),ve=e.useRef(null),ye=e.useRef(null),je=e.useRef(null),Ne=e.useRef(null),ke=e.useRef(null),Ce=async e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a&&"application/pdf"===a.type){pe(!0),B(a),W({});try{const e=await a.arrayBuffer(),t=await window.pdfjsLib.getDocument(e).promise,s=[];for(let a=1;a<=t.numPages;a++){const e=await t.getPage(a),r=e.getViewport({scale:.2}),o=document.createElement("canvas"),l=o.getContext("2d");o.height=r.height,o.width=r.width,await e.render({canvasContext:l,viewport:r}).promise,s.push({id:Math.random().toString(36).substr(2,9),originalIndex:a-1,rotation:0,thumbnail:o.toDataURL()})}L(s),$(s[0].id)}catch(s){alert("Error loading PDF")}finally{pe(!1)}}};e.useEffect(()=>{if(!I||!H||!je.current)return;const e=E.find(e=>e.id===H);if(!e)return;(async()=>{const t=await I.arrayBuffer(),a=await window.pdfjsLib.getDocument(t).promise,s=await a.getPage(e.originalIndex+1),r=(s.rotate+e.rotation)%360,o=s.getViewport({scale:O,rotation:r}),l=je.current,i=l.getContext("2d");l.height=o.height,l.width=o.width,await s.render({canvasContext:i,viewport:o}).promise;const n=(await s.getTextContent()).items.map(e=>{const t=window.pdfjsLib.Util.transform(o.transform,e.transform),a=Math.hypot(t[2],t[3]),s=e.width*O;return{item:e,viewportRect:[t[4],t[5]-a,s,a]}});V(n)})()},[I,H,O,E]);const Se=e=>{if(!Ne.current)return{x:0,y:0};const t=Ne.current.getBoundingClientRect(),a="touches"in e?e.touches[0].clientX:e.clientX,s="touches"in e?e.touches[0].clientY:e.clientY;return{x:a-t.left,y:s-t.top}},Fe=e=>{if(!H)return;const{x:t,y:a}=Se(e);if("eyedropper"===_){const e=je.current;if(e){const s=e.getContext("2d");if(s){const e=s.getImageData(t,a,1,1).data,r="#"+("000000"+(e[0]<<16|e[1]<<8|e[2]).toString(16)).slice(-6);Z(r),J("select")}}return}if("select"!==_){if("text"===_){const e=Date.now().toString();Me({id:e,type:"text",x:t,y:a,text:"Type here",color:Q,backgroundColor:"transparent"===G?void 0:G,size:ee,fontFamily:ae,fontWeight:re?"bold":"normal",fontStyle:le?"italic":"normal"}),de(e),J("select")}else if(["rect","circle","eraser","image","signature"].includes(_)){let e=100*O,s=100*O,r=Q;"eraser"===_&&(r="#FFFFFF",s=50*O),"circle"===_&&(e=50*O,s=50*O);const o=Date.now().toString();Me({id:o,type:_,x:t,y:a,width:e,height:s,color:r}),de(o),J("select")}else if("draw"===_||"highlight"===_){he(!0);const e=Date.now().toString();Me({id:e,type:_,x:t,y:a,points:[{x:t,y:a}],color:"highlight"===_?"#FFFF00":Q,opacity:"highlight"===_?.4:1,size:"highlight"===_?20:ee/4})}}else de(null)},Re=(e,t,a)=>{var s;if(e.stopPropagation(),"select"!==_)return;const{x:r,y:o}=Se(e),l=(null==(s=U[H])?void 0:s.find(e=>e.id===t))||null;de(t),we({x:r,y:o,elId:t,initialEl:l?{...l}:null,handle:a})},De=e=>{const{x:t,y:a}=Se(e);if(fe&&fe.elId&&H&&"select"===_){e.preventDefault();const s=t-fe.x,r=a-fe.y,o=fe.initialEl;if(!o)return;let l={};if(fe.handle){const e=fe.handle,t=o.width||0,a=o.height||0,i=o.x,n=o.y;let d=i,c=n,h=t,u=a;if(e.includes("e")&&(h=Math.max(20,t+s)),e.includes("w")){const e=t-20,a=Math.min(s,e);h=t-a,d=i+a}if(e.includes("s")&&(u=Math.max(20,a+r)),e.includes("n")){const e=a-20,t=Math.min(r,e);u=a-t,c=n+t}l={x:d,y:c,width:h,height:u}}else l={x:o.x+s,y:o.y+r};return void ze(fe.elId,l)}ce&&H&&W(e=>{const s=e[H]||[];if(0===s.length)return e;const r=s[s.length-1];if(!r.points)return e;const o={...r,points:[...r.points,{x:t,y:a}]},l=[...s.slice(0,-1),o];return{...e,[H]:l}})},Te=()=>{we(null),he(!1)},Me=e=>{H&&W(t=>({...t,[H]:[...t[H]||[],e]}))},ze=(e,t)=>{H&&W(a=>({...a,[H]:(a[H]||[]).map(a=>a.id===e?{...a,...t}:a)}))},Pe=(e,t)=>{const a=[...E];"up"===t&&e>0?[a[e],a[e-1]]=[a[e-1],a[e]]:"down"===t&&e<a.length-1&&([a[e],a[e+1]]=[a[e+1],a[e]]),L(a)};return I?t.jsxs("div",{className:"flex flex-col h-[calc(100vh-100px)] bg-slate-100 dark:bg-slate-950",children:[t.jsxs("div",{className:"h-16 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between px-4 shadow-sm z-20",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>A(!Y),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg text-slate-500",children:t.jsx(r,{className:"w-5 h-5"})}),t.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-slate-700 mx-2"}),t.jsx("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1 rounded-lg",children:[{id:"select",icon:o,title:"Select"},{id:"smart-edit",icon:l,title:"Smart Text Edit"},{id:"eyedropper",icon:i,title:"Pick Color from Page"},{id:"text",icon:n,title:"Add Text"},{id:"draw",icon:d,title:"Draw"},{id:"highlight",icon:c,title:"Highlight"},{id:"eraser",icon:h,title:"Eraser"}].map(e=>t.jsx("button",{onClick:()=>J(e.id),className:"p-2 rounded-md transition-all "+(_===e.id?"bg-white dark:bg-slate-700 shadow text-primary-600":"text-slate-500 hover:text-slate-900 dark:hover:text-white"),title:e.title,children:t.jsx(e.icon,{className:"w-4 h-4"})},e.id))}),t.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1 rounded-lg",children:[t.jsx("button",{onClick:()=>J("rect"),className:"p-2 rounded-md "+("rect"===_?"bg-white dark:bg-slate-700 shadow text-primary-600":"text-slate-500"),children:t.jsx(u,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>J("circle"),className:"p-2 rounded-md "+("circle"===_?"bg-white dark:bg-slate-700 shadow text-primary-600":"text-slate-500"),children:t.jsx(x,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1 rounded-lg",children:[t.jsx("button",{onClick:()=>{var e;return null==(e=ye.current)?void 0:e.click()},className:"p-2 text-slate-500 hover:text-slate-900",title:"Insert Image",children:t.jsx(g,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>xe(!0),className:"p-2 text-slate-500 hover:text-slate-900",title:"Sign",children:t.jsx(p,{className:"w-4 h-4"})}),t.jsx("input",{type:"file",ref:ye,className:"hidden",accept:"image/*",onChange:e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a&&H){const e=new FileReader;e.onload=()=>{const t=Date.now().toString();Me({id:t,type:"image",x:50,y:50,width:200,height:200,color:"transparent",imageData:e.result}),J("select")},e.readAsDataURL(a)}}})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[t.jsxs("div",{className:"relative group",children:[t.jsx("button",{className:"p-2 rounded bg-slate-100 dark:bg-slate-800 flex items-center gap-1 border border-slate-200 dark:border-slate-700",children:t.jsx("div",{className:"w-4 h-4 rounded-full border border-slate-300",style:{backgroundColor:Q}})}),t.jsx("input",{type:"color",value:Q,onChange:e=>{Z(e.target.value),["select","eyedropper"].includes(_)&&J("text")},className:"absolute inset-0 opacity-0 cursor-pointer w-full h-full"})]}),("text"===_||"smart-edit"===_)&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"h-6 w-px bg-slate-200 dark:bg-slate-700 mx-1"}),t.jsx("select",{value:ae,onChange:e=>se(e.target.value),className:"text-xs p-1.5 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 dark:text-white outline-none w-24",children:T.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))}),t.jsx("select",{value:ee,onChange:e=>te(Number(e.target.value)),className:"text-xs p-1.5 rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 dark:text-white outline-none w-14",children:[10,12,14,16,18,20,24,30,36,48,64,72].map(e=>t.jsxs("option",{value:e,children:[e,"px"]},e))}),t.jsx("button",{onClick:()=>oe(!re),className:"p-1.5 rounded "+(re?"bg-slate-200 dark:bg-slate-700":"hover:bg-slate-100 dark:hover:bg-slate-800"),children:t.jsx(m,{className:"w-3.5 h-3.5"})}),t.jsx("button",{onClick:()=>ie(!le),className:"p-1.5 rounded "+(le?"bg-slate-200 dark:bg-slate-700":"hover:bg-slate-100 dark:hover:bg-slate-800"),children:t.jsx(b,{className:"w-3.5 h-3.5"})}),t.jsxs("div",{className:"relative group ml-1",title:"Background Color (Whiteout)",children:[t.jsx("div",{className:"p-1.5 rounded cursor-pointer border "+("transparent"===G?"border-dashed border-slate-300":"border-slate-300"),style:{backgroundColor:"transparent"===G?"transparent":G},children:t.jsx(f,{className:"w-3.5 h-3.5 text-slate-500"})}),t.jsxs("select",{value:G,onChange:e=>K(e.target.value),className:"absolute inset-0 opacity-0 cursor-pointer",children:[t.jsx("option",{value:"transparent",children:"None (Transparent)"}),t.jsx("option",{value:"#FFFFFF",children:"White (Cover)"}),t.jsx("option",{value:"#000000",children:"Black"}),t.jsx("option",{value:"#F1F5F9",children:"Slate 100"})]})]})]})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-1 bg-slate-100 dark:bg-slate-800 rounded-lg p-1",children:[t.jsx("button",{onClick:()=>X(e=>Math.max(.5,e-.25)),className:"p-1 hover:bg-white dark:hover:bg-slate-700 rounded",children:t.jsx(w,{className:"w-4 h-4 text-slate-500"})}),t.jsxs("span",{className:"text-xs font-medium w-12 text-center dark:text-slate-300",children:[Math.round(100*O),"%"]}),t.jsx("button",{onClick:()=>X(e=>Math.min(3,e+.25)),className:"p-1 hover:bg-white dark:hover:bg-slate-700 rounded",children:t.jsx(v,{className:"w-4 h-4 text-slate-500"})})]}),t.jsxs("button",{onClick:async()=>{if(I){be(!0);try{const e=await I.arrayBuffer(),t=await F.load(e),a=await F.create(),s={},r=async(e="Helvetica",t,r)=>{const o=`${e}-${t?"B":""}${r?"I":""}`;if(s[o])return s[o];let l=R.Helvetica;l="Times-Roman"===e?t&&r?R.TimesRomanBoldItalic:t?R.TimesRomanBold:r?R.TimesRomanItalic:R.TimesRoman:"Courier"===e?t&&r?R.CourierBoldOblique:t?R.CourierBold:r?R.CourierOblique:R.Courier:t&&r?R.HelveticaBoldOblique:t?R.HelveticaBold:r?R.HelveticaOblique:R.Helvetica;const i=await a.embedFont(l);return s[o]=i,i};for(const d of E){const[e]=await a.copyPages(t,[d.originalIndex]),s=a.addPage(e),o=s.getRotation().angle;s.setRotation((o+d.rotation)%360);const{width:l,height:i}=s.getSize(),n=1/O;for(const t of U[d.id]||[]){const e=t.x*n,o=i-t.y*n,l=parseInt(t.color.slice(1,3),16)/255,d=parseInt(t.color.slice(3,5),16)/255,c=parseInt(t.color.slice(5,7),16)/255,h=D(l,d,c);if("text"===t.type&&t.text){const a=(t.size||16)*n,l=await r(t.fontFamily,"bold"===t.fontWeight,"italic"===t.fontStyle);if(t.backgroundColor&&"transparent"!==t.backgroundColor){const r=l.widthOfTextAtSize(t.text,a),i=l.heightAtSize(a),n=parseInt(t.backgroundColor.slice(1,3),16)/255,d=parseInt(t.backgroundColor.slice(3,5),16)/255,c=parseInt(t.backgroundColor.slice(5,7),16)/255;s.drawRectangle({x:e-2,y:o-a+2,width:r+4,height:i+2,color:D(n,d,c)})}s.drawText(t.text,{x:e,y:o-a+.2*a,size:a,font:l,color:h})}else if(["rect","eraser"].includes(t.type))s.drawRectangle({x:e,y:o-(t.height||0)*n,width:(t.width||0)*n,height:(t.height||0)*n,color:h,opacity:t.opacity??1});else if("highlight"===t.type&&t.points){const e=t.points.map(e=>({x:e.x*n,y:i-e.y*n}));for(let a=0;a<e.length-1;a++)s.drawLine({start:e[a],end:e[a+1],thickness:(t.size||20)*n,color:h,opacity:t.opacity})}else if("draw"===t.type&&t.points){const e=t.points.map(e=>({x:e.x*n,y:i-e.y*n}));for(let a=0;a<e.length-1;a++)s.drawLine({start:e[a],end:e[a+1],thickness:(t.size||2)*n,color:h,opacity:1})}else if(("image"===t.type||"signature"===t.type)&&t.imageData){const r=await fetch(t.imageData).then(e=>e.arrayBuffer());let l;l=t.imageData.includes("image/png")?await a.embedPng(r):await a.embedJpg(r),s.drawImage(l,{x:e,y:o-(t.height||0)*n,width:(t.width||0)*n,height:(t.height||0)*n})}}}const o=await a.save(),l=new Blob([o],{type:"application/pdf"}),i=URL.createObjectURL(l),n=document.createElement("a");n.href=i,n.download=`edited_${I.name}`,n.click()}catch(e){alert("Failed to export PDF.")}finally{be(!1)}}},disabled:me,className:"px-4 py-2 bg-primary-600 text-white rounded-lg text-sm font-bold flex items-center gap-2 hover:bg-primary-700 shadow-lg shadow-primary-500/20 disabled:opacity-70",children:[me?t.jsx(a,{className:"w-4 h-4 animate-spin"}):t.jsx(y,{className:"w-4 h-4"}),"Export PDF"]})]})]}),t.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[Y&&t.jsxs("div",{className:"w-64 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex flex-col",children:[t.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-800",children:t.jsxs("h3",{className:"font-bold text-slate-700 dark:text-slate-300 text-sm",children:["Pages (",E.length,")"]})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:E.map((e,s)=>t.jsxs("div",{className:"relative group p-2 rounded-xl border-2 transition-all "+(H===e.id?"border-primary-500 bg-primary-50 dark:bg-primary-900/10":"border-transparent hover:border-slate-200 dark:hover:border-slate-700"),onClick:()=>$(e.id),children:[t.jsxs("div",{className:"aspect-[3/4] bg-white shadow-sm rounded-lg overflow-hidden relative",children:[e.thumbnail?t.jsx("img",{src:e.thumbnail,className:"w-full h-full object-contain",style:{transform:`rotate(${e.rotation}deg)`}}):t.jsx("div",{className:"w-full h-full flex items-center justify-center text-slate-300",children:t.jsx(a,{className:"animate-spin"})}),t.jsx("div",{className:"absolute top-1 left-1 bg-black/50 text-white text-[10px] px-1.5 rounded",children:s+1})]}),t.jsxs("div",{className:"absolute top-2 right-2 flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[t.jsx("button",{onClick:t=>{var a;t.stopPropagation(),a=e.id,L(e=>e.map(e=>e.id===a?{...e,rotation:(e.rotation+90)%360}:e))},className:"p-1.5 bg-slate-800 text-white rounded-full hover:bg-primary-600",title:"Rotate",children:t.jsx(j,{className:"w-3 h-3"})}),t.jsx("button",{onClick:t=>{t.stopPropagation(),(e=>{if(E.length<=1)return;const t=E.findIndex(t=>t.id===e),a=E.filter(t=>t.id!==e);L(a),H===e&&$(a[Math.max(0,t-1)].id);const s={...U};delete s[e],W(s)})(e.id)},className:"p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600",title:"Delete",children:t.jsx(N,{className:"w-3 h-3"})}),t.jsx("button",{onClick:e=>{e.stopPropagation(),Pe(s,"up")},disabled:0===s,className:"p-1.5 bg-slate-800 text-white rounded-full hover:bg-primary-600 disabled:opacity-50",children:t.jsx(k,{className:"w-3 h-3"})}),t.jsx("button",{onClick:e=>{e.stopPropagation(),Pe(s,"down")},disabled:s===E.length-1,className:"p-1.5 bg-slate-800 text-white rounded-full hover:bg-primary-600 disabled:opacity-50",children:t.jsx(C,{className:"w-3 h-3"})})]})]},e.id))})]}),t.jsx("div",{className:"flex-1 overflow-auto bg-slate-100 dark:bg-slate-950 p-8 flex justify-center relative",ref:ke,style:{cursor:"eyedropper"===_?"crosshair":"default"},children:H?t.jsxs("div",{className:"relative shadow-2xl transition-transform origin-top",style:{width:(null==(z=je.current)?void 0:z.width)||"auto",height:(null==(P=je.current)?void 0:P.height)||"auto"},children:[t.jsx("canvas",{ref:je,className:"block bg-white"}),"smart-edit"===_&&t.jsx("div",{className:"absolute inset-0 z-10 pointer-events-none",children:q.map((e,a)=>t.jsx("div",{className:"absolute bg-blue-500/10 hover:bg-blue-500/30 border border-transparent hover:border-blue-500 cursor-text pointer-events-auto transition-colors",style:{left:e.viewportRect[0],top:e.viewportRect[1],width:e.viewportRect[2],height:e.viewportRect[3]},onClick:t=>{t.stopPropagation(),((e,t)=>{if("smart-edit"!==_||!H)return;const a={id:Date.now().toString(),type:"rect",x:t[0]-2,y:t[1]-2,width:t[2]+4,height:t[3]+4,color:"#FFFFFF"};Me(a);const s=Math.round(.8*t[3]),r=(Date.now()+1).toString(),o={id:r,type:"text",x:t[0],y:t[1]+t[3]/2,text:e,color:Q,size:s,fontFamily:ae,fontWeight:re?"bold":"normal"};setTimeout(()=>{Me(o),de(r)},10)})(e.item.str,e.viewportRect)},title:"Click to Edit Text"},a))}),t.jsx("div",{ref:Ne,className:"absolute inset-0 touch-none z-20",onMouseDown:Fe,onMouseMove:De,onMouseUp:Te,onTouchStart:Fe,onTouchMove:De,onTouchEnd:Te,children:(U[H]||[]).map(e=>{var a;return t.jsxs("div",{style:{position:"absolute",left:e.x,top:e.y,pointerEvents:"select"===_?"auto":"none",cursor:"select"===_?"move":"none",border:ne===e.id&&"select"===_?"2px dashed #3b82f6":"none",transform:"text"===e.type?"translate(0, -50%)":"none"},onMouseDown:t=>Re(t,e.id,null),onTouchStart:t=>Re(t,e.id,null),children:["text"===e.type?ne===e.id?t.jsx("input",{autoFocus:!0,value:e.text,onChange:t=>ze(e.id,{text:t.target.value}),className:"bg-transparent border-none outline-none p-0",style:{color:e.color,backgroundColor:e.backgroundColor||"transparent",fontSize:`${e.size}px`,fontFamily:"Times-Roman"===e.fontFamily?"Times New Roman":"Courier"===e.fontFamily?"Courier New":"Arial",fontWeight:e.fontWeight,fontStyle:e.fontStyle,minWidth:"20px"}}):t.jsx("span",{style:{color:e.color,backgroundColor:e.backgroundColor||"transparent",fontSize:`${e.size}px`,fontFamily:"Times-Roman"===e.fontFamily?"Times New Roman":"Courier"===e.fontFamily?"Courier New":"Arial",fontWeight:e.fontWeight,fontStyle:e.fontStyle,whiteSpace:"nowrap",userSelect:"none",padding:"2px"},children:e.text}):["rect","eraser"].includes(e.type)?t.jsx("div",{style:{width:e.width,height:e.height,backgroundColor:e.color,opacity:e.opacity??1}}):["circle"].includes(e.type)?t.jsx("div",{style:{width:e.width,height:e.height,backgroundColor:e.color,borderRadius:"50%"}}):["image","signature"].includes(e.type)?t.jsx("img",{src:e.imageData,style:{width:e.width,height:e.height},draggable:!1}):"draw"===e.type||"highlight"===e.type?t.jsx("svg",{style:{position:"absolute",left:-e.x,top:-e.y,overflow:"visible",pointerEvents:"none"},children:t.jsx("polyline",{points:null==(a=e.points)?void 0:a.map(e=>`${e.x},${e.y}`).join(" "),fill:"none",stroke:e.color,strokeWidth:e.size,strokeLinecap:"round",strokeLinejoin:"round",opacity:e.opacity??1})}):null,ne===e.id&&"select"===_&&["image","signature","rect","circle"].includes(e.type)&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute -top-2 -left-2 w-4 h-4 bg-white border border-blue-500 rounded-full cursor-nw-resize z-50 shadow-sm",onMouseDown:t=>Re(t,e.id,"nw"),onTouchStart:t=>Re(t,e.id,"nw")}),t.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-white border border-blue-500 rounded-full cursor-ne-resize z-50 shadow-sm",onMouseDown:t=>Re(t,e.id,"ne"),onTouchStart:t=>Re(t,e.id,"ne")}),t.jsx("div",{className:"absolute -bottom-2 -left-2 w-4 h-4 bg-white border border-blue-500 rounded-full cursor-sw-resize z-50 shadow-sm",onMouseDown:t=>Re(t,e.id,"sw"),onTouchStart:t=>Re(t,e.id,"sw")}),t.jsx("div",{className:"absolute -bottom-2 -right-2 w-4 h-4 bg-white border border-blue-500 rounded-full cursor-se-resize z-50 shadow-sm",onMouseDown:t=>Re(t,e.id,"se"),onTouchStart:t=>Re(t,e.id,"se")})]}),ne===e.id&&"select"===_&&t.jsx("button",{onClick:t=>{var a;t.stopPropagation(),a=e.id,H&&(W(e=>({...e,[H]:(e[H]||[]).filter(e=>e.id!==a)})),de(null))},className:"absolute -top-3 -right-3 bg-red-500 text-white rounded-full p-1 shadow-md hover:bg-red-600 z-50",title:"Delete Element",children:t.jsx(S,{className:"w-3 h-3"})})]},e.id)})})]}):t.jsx("div",{className:"flex flex-col items-center justify-center text-slate-400",children:t.jsx("p",{children:"Select a page to edit"})})})]}),t.jsx(M,{isOpen:ue,onClose:()=>xe(!1),onSave:e=>{if(H){const t=Date.now().toString();Me({id:t,type:"signature",x:100,y:100,width:150,height:80,color:"transparent",imageData:e}),J("select")}}})]}):t.jsx("div",{className:"max-w-4xl mx-auto py-12 px-4",children:t.jsx("div",{className:"bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 p-12 text-center",children:ge?t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(a,{className:"w-12 h-12 text-primary-600 animate-spin mb-4"}),t.jsx("p",{className:"text-xl font-bold dark:text-white",children:"Loading PDF..."})]}):t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-4",children:"PDF Editor Studio"}),t.jsx("p",{className:"text-slate-500 mb-8 max-w-lg mx-auto",children:"Upload a PDF to start editing. Edit text, sign, draw, and manage pages securely in your browser."}),t.jsxs("div",{onClick:()=>{var e;return null==(e=ve.current)?void 0:e.click()},className:"border-3 border-dashed border-slate-300 dark:border-slate-700 rounded-3xl p-16 flex flex-col items-center justify-center cursor-pointer hover:border-primary-500 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all group",children:[t.jsx("div",{className:"w-24 h-24 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center mb-6 group-hover:scale-110 transition-transform",children:t.jsx(s,{className:"w-12 h-12 text-primary-600 dark:text-primary-400"})}),t.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Click to Upload PDF"}),t.jsx("p",{className:"text-slate-500 mt-2",children:"Max 50MB"})]}),t.jsx("input",{type:"file",ref:ve,className:"hidden",accept:"application/pdf",onChange:Ce})]})})})};export{z as default};
